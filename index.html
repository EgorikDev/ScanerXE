<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkanerXE - AI –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –µ–¥—ã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #667eea;
            --primary-dark: #5a6fd8;
            --secondary: #764ba2;
            --success: #48bb78;
            --danger: #f56565;
            --warning: #ed8936;
            --dark: #2d3748;
            --light: #f7fafc;
            --gray: #718096;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        header {
            background: var(--dark);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .user-info {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-badge {
            background: var(--warning);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        header p {
            opacity: 0.8;
            font-size: 14px;
        }
        
        .main-content {
            padding: 20px;
            min-height: 500px;
        }
        
        .auth-forms {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn-secondary:hover {
            background: #cbd5e0;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #38a169;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #e53e3e;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 10px;
            background: var(--light);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .section h2 {
            margin-bottom: 15px;
            color: var(--dark);
            font-size: 18px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }
        
        .balance-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #ebf8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .balance-amount {
            font-size: 24px;
            font-weight: bold;
            color: #2b6cb0;
        }
        
        .free-requests {
            font-size: 14px;
            color: var(--gray);
        }
        
        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background: #f0f4ff;
        }
        
        .upload-area i {
            font-size: 48px;
            color: #a0aec0;
            margin-bottom: 15px;
        }
        
        .upload-area p {
            margin-bottom: 10px;
        }
        
        .upload-area small {
            color: var(--gray);
        }
        
        #image-preview {
            max-width: 100%;
            max-height: 300px;
            margin: 15px auto;
            display: none;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .payment-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .payment-option {
            padding: 15px;
            text-align: center;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .payment-option:hover {
            border-color: var(--primary);
            background: #f0f4ff;
        }
        
        .payment-option.selected {
            border-color: var(--primary);
            background: #ebf8ff;
            font-weight: bold;
        }
        
        .result-area {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .result-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--dark);
        }
        
        .nutrition-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .nutrition-item {
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            text-align: center;
        }
        
        .nutrition-value {
            font-size: 20px;
            font-weight: bold;
            color: #2b6cb0;
        }
        
        .nutrition-label {
            font-size: 14px;
            color: var(--gray);
            margin-top: 5px;
        }
        
        .recommendations {
            background: #f0fff4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid var(--success);
        }
        
        .recommendations h4 {
            color: var(--success);
            margin-bottom: 10px;
        }
        
        .weight-control {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }
        
        .weight-control input {
            flex: 1;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
        }
        
        .weight-control button {
            border-radius: 0 8px 8px 0;
            border-left: none;
        }
        
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .tab-container {
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            font-weight: bold;
            color: var(--primary);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .history-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-date {
            font-size: 12px;
            color: var(--gray);
        }
        
        .history-dish {
            font-weight: bold;
            margin: 5px 0;
        }
        
        .history-calories {
            color: #2b6cb0;
            font-weight: bold;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: #f7fafc;
            color: var(--gray);
            font-size: 14px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid;
        }
        
        .alert-success {
            background: #f0fff4;
            border-color: #9ae6b4;
            color: #22543d;
        }
        
        .alert-error {
            background: #fed7d7;
            border-color: #feb2b2;
            color: #742a2a;
        }
        
        .alert-info {
            background: #bee3f8;
            border-color: #90cdf4;
            color: #2a4365;
        }
        
        .admin-panel {
            background: #fff5f5;
            border: 1px solid #fed7d7;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray);
        }
        
        .users-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .user-item {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: between;
            align-items: center;
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-email {
            font-weight: bold;
        }
        
        .user-balance {
            color: var(--success);
        }
        
        @media (max-width: 768px) {
            .payment-options {
                grid-template-columns: 1fr;
            }
            
            .nutrition-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                position: static;
                transform: none;
                justify-content: center;
                margin-top: 10px;
            }
            
            .tabs {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>SkanerXE</h1>
            <p>AI –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –∏ —Å–æ—Å—Ç–∞–≤–∞ –±–ª—é–¥</p>
            <div class="user-info" id="user-info" style="display: none;">
                <span id="user-email"></span>
                <span class="admin-badge" id="admin-badge" style="display: none;">ADMIN</span>
                <button class="btn btn-secondary btn-sm" id="logout-btn">–í—ã–π—Ç–∏</button>
            </div>
        </header>
        
        <div class="main-content">
            <!-- –§–æ—Ä–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
            <div id="auth-section">
                <div class="auth-forms">
                    <div class="section">
                        <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                        <div class="form-group">
                            <label for="login-email">Email:</label>
                            <input type="email" id="login-email" placeholder="–í–∞—à email">
                        </div>
                        <div class="form-group">
                            <label for="login-password">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="login-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
                        </div>
                        <button class="btn btn-block" id="login-btn">–í–æ–π—Ç–∏</button>
                    </div>
                    
                    <div class="section">
                        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
                        <div class="form-group">
                            <label for="register-email">Email:</label>
                            <input type="email" id="register-email" placeholder="–í–∞—à email">
                        </div>
                        <div class="form-group">
                            <label for="register-password">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="register-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <div class="form-group">
                            <label for="register-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="register-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        </div>
                        <button class="btn btn-success btn-block" id="register-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </div>
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
            <div id="app-section" style="display: none;">
                <div class="section">
                    <div class="balance-info">
                        <div>
                            <div class="balance-amount" id="balance-amount">0 —Ä—É–±</div>
                            <div class="free-requests" id="free-requests">–ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤: 0/10</div>
                        </div>
                        <button class="btn" id="topup-btn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    </div>
                    
                    <div class="tab-container">
                        <div class="tabs">
                            <div class="tab active" data-tab="analysis">–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ</div>
                            <div class="tab" data-tab="payments">–ü–ª–∞—Ç–µ–∂–∏</div>
                            <div class="tab" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</div>
                            <div class="tab" data-tab="info">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                            <div class="tab admin-only" data-tab="admin" style="display: none;">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
                        </div>
                        
                        <div class="tab-content active" id="analysis-tab">
                            <h2>–ê–Ω–∞–ª–∏–∑ –±–ª—é–¥–∞ –ø–æ —Ñ–æ—Ç–æ</h2>
                            
                            <div class="upload-area" id="upload-area">
                                <i>üì∑</i>
                                <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞</p>
                                <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, WEBP</small>
                            </div>
                            
                            <input type="file" id="file-input" accept="image/*" style="display: none;">
                            
                            <img id="image-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                            
                            <div class="loader" id="analyze-loader">
                                <div class="loader-spinner"></div>
                                <p>–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–æ—Ç–æ —Å –ø–æ–º–æ—â—å—é AI...</p>
                            </div>
                            
                            <button class="btn btn-block" id="analyze-btn" style="display: none;">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å (1 —Ä—É–±–ª—å)</button>
                            
                            <div class="result-area" id="result-area">
                                <h3 class="result-title" id="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h3>
                                <div class="nutrition-grid" id="nutrition-grid">
                                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                                </div>
                                
                                <div class="recommendations" id="recommendations">
                                    <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—é -->
                                </div>
                                
                                <div class="weight-control">
                                    <input type="number" id="weight-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω—ã–π –≤–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö">
                                    <button class="btn" id="recalculate-btn">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å (1 —Ä—É–±–ª—å)</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="payments-tab">
                            <h2>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h2>
                            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 50 —Ä—É–±):</p>
                            
                            <div class="payment-options">
                                <div class="payment-option" data-amount="50">50 —Ä—É–±</div>
                                <div class="payment-option" data-amount="100">100 —Ä—É–±</div>
                                <div class="payment-option" data-amount="500">500 —Ä—É–±</div>
                                <div class="payment-option" data-amount="1000">1000 —Ä—É–±</div>
                            </div>
                            
                            <div style="margin: 15px 0;">
                                <input type="number" id="custom-amount" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é —Å—É–º–º—É" style="width: 100%; padding: 12px; border: 1px solid #cbd5e0; border-radius: 8px;">
                            </div>
                            
                            <button class="btn btn-block" id="payment-btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</button>
                            
                            <div style="margin-top: 20px; padding: 15px; background: #f0fff4; border-radius: 8px;">
                                <h3>–û–∂–∏–¥–∞—é—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏</h3>
                                <div id="pending-payments">
                                    <p>–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π</p>
                                </div>
                                <button class="btn btn-secondary btn-block" id="check-payments-btn" style="margin-top: 10px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–∞—Ç–µ–∂–∏</button>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="history-tab">
                            <h2>–ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤</h2>
                            <div id="history-list">
                                <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–æ–≤</p>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="info-tab">
                            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
                            <p>SkanerXE - —ç—Ç–æ —É–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –µ–¥—ã, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–∞ –∏ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏ –±–ª—é–¥ –ø–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.</p>
                            
                            <h3 style="margin-top: 20px;">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
                            <ol style="margin-left: 20px; margin-top: 10px;">
                                <li>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –±–ª—é–¥–∞</li>
                                <li>–ò–ò GPT-4 –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Å–æ—Å—Ç–∞–≤ –∏ –≤–µ—Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤</li>
                                <li>–ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∏—â–µ–≤–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏</li>
                                <li>–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É—Ç–æ—á–Ω–∏—Ç–µ –≤–µ—Å –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞</li>
                            </ol>
                            
                            <h3 style="margin-top: 20px;">–¢–∞—Ä–∏—Ñ—ã</h3>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li>–ù–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º - 10 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤</li>
                                <li>–ü–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ - 1 —Ä—É–±–ª—å –∑–∞ –∞–Ω–∞–ª–∏–∑</li>
                                <li>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–µ—Å–∞ –±–ª—é–¥–∞ - 1 —Ä—É–±–ª—å</li>
                            </ul>
                        </div>
                        
                        <div class="tab-content admin-panel" id="admin-tab">
                            <h2>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
                            
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="stat-users">0</div>
                                    <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="stat-balance">0 —Ä—É–±</div>
                                    <div class="stat-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="stat-analyses">0</div>
                                    <div class="stat-label">–í—Å–µ–≥–æ –∞–Ω–∞–ª–∏–∑–æ–≤</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="stat-payments">0</div>
                                    <div class="stat-label">–û–∂–∏–¥–∞—é—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π</div>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                                <div class="users-list" id="users-list">
                                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</p>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h3>
                                <div class="form-group">
                                    <label for="min-payment">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä—É–±):</label>
                                    <input type="number" id="min-payment" value="50">
                                </div>
                                <button class="btn" id="save-settings-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>–°–∞–º–æ–∑–∞–Ω—è—Ç—ã–π –ß—É–º–∞–∫–æ–≤ –î–º–∏—Ç—Ä–∏–π –ï–≤–≥–µ–Ω—å–µ–≤–∏—á | –ò–ù–ù: 132610382652 | ¬© 2024 SkanerXE. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </footer>
    </div>

    <script>
        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        class Database {
            constructor() {
                this.users = JSON.parse(localStorage.getItem('skanerxe_users')) || {};
                this.analyses = JSON.parse(localStorage.getItem('skanerxe_analyses')) || {};
                this.payments = JSON.parse(localStorage.getItem('skanerxe_payments')) || {};
                this.settings = JSON.parse(localStorage.getItem('skanerxe_settings')) || {
                    min_payment: 50
                };
                
                // –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                if (!this.users['admin@skanerxe.ru']) {
                    this.users['admin@skanerxe.ru'] = {
                        password: this.hashPassword('admin123'),
                        balance: 0,
                        free_requests: 999,
                        is_admin: true,
                        created_at: new Date().toISOString()
                    };
                    this.saveUsers();
                }
            }
            
            saveUsers() {
                localStorage.setItem('skanerxe_users', JSON.stringify(this.users));
            }
            
            saveAnalyses() {
                localStorage.setItem('skanerxe_analyses', JSON.stringify(this.analyses));
            }
            
            savePayments() {
                localStorage.setItem('skanerxe_payments', JSON.stringify(this.payments));
            }
            
            saveSettings() {
                localStorage.setItem('skanerxe_settings', JSON.stringify(this.settings));
            }
            
            hashPassword(password) {
                let hash = 0;
                for (let i = 0; i < password.length; i++) {
                    const char = password.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            }
            
            registerUser(email, password) {
                if (this.users[email]) {
                    return { success: false, error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
                }
                
                this.users[email] = {
                    password: this.hashPassword(password),
                    balance: 0,
                    free_requests: 10,
                    is_admin: false,
                    created_at: new Date().toISOString()
                };
                
                this.saveUsers();
                return { success: true };
            }
            
            loginUser(email, password) {
                const user = this.users[email];
                if (!user) {
                    return { success: false, error: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω' };
                }
                
                if (user.password !== this.hashPassword(password)) {
                    return { success: false, error: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å' };
                }
                
                return { 
                    success: true, 
                    user: {
                        email: email,
                        balance: user.balance,
                        free_requests: user.free_requests,
                        is_admin: user.is_admin
                    }
                };
            }
            
            addAnalysis(email, analysisData) {
                const analysisId = 'analysis_' + Date.now();
                this.analyses[analysisId] = {
                    ...analysisData,
                    user_email: email,
                    created_at: new Date().toISOString()
                };
                this.saveAnalyses();
                return analysisId;
            }
            
            getUserAnalyses(email) {
                return Object.values(this.analyses)
                    .filter(analysis => analysis.user_email === email)
                    .sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
            }
            
            updateUserBalance(email, amount) {
                if (this.users[email]) {
                    this.users[email].balance += amount;
                    this.saveUsers();
                    return true;
                }
                return false;
            }
            
            useFreeRequest(email) {
                if (this.users[email] && this.users[email].free_requests > 0) {
                    this.users[email].free_requests--;
                    this.saveUsers();
                    return true;
                }
                return false;
            }
            
            createPayment(email, amount) {
                const paymentId = 'pay_' + Date.now();
                this.payments[paymentId] = {
                    user_email: email,
                    amount: amount,
                    status: 'pending',
                    created_at: new Date().toISOString()
                };
                this.savePayments();
                return paymentId;
            }
            
            completePayment(paymentId) {
                if (this.payments[paymentId]) {
                    this.payments[paymentId].status = 'completed';
                    this.payments[paymentId].completed_at = new Date().toISOString();
                    
                    const payment = this.payments[paymentId];
                    this.updateUserBalance(payment.user_email, payment.amount);
                    
                    this.savePayments();
                    return true;
                }
                return false;
            }
            
            getPendingPayments(email) {
                return Object.values(this.payments)
                    .filter(payment => payment.user_email === email && payment.status === 'pending');
            }
            
            getAllUsers() {
                return Object.entries(this.users).map(([email, data]) => ({
                    email,
                    ...data
                }));
            }
            
            getStats() {
                const users = this.getAllUsers();
                return {
                    total_users: users.length,
                    total_balance: users.reduce((sum, user) => sum + user.balance, 0),
                    total_analyses: Object.keys(this.analyses).length,
                    pending_payments: Object.values(this.payments).filter(p => p.status === 'pending').length
                };
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Robokassa
        class RobokassaPayment {
            constructor() {
                this.login = "SkanerXEbot";
                this.password1 = "c7zMQKpaDT979pB3WhUO";
                this.password2 = "gvTgn6Bh5T6VUhu8RG6t";
            }
            
            generateSignature(amount, paymentId, userId, password) {
                const signatureString = `${this.login}:${amount}:${paymentId}:${password}:shp_userId=${userId}`;
                return this.md5(signatureString).toLowerCase();
            }
            
            generatePaymentLink(amount, paymentId, userId, description = "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ SkanerXE") {
                const crc = this.generateSignature(amount, paymentId, userId, this.password1);
                
                return `https://auth.robokassa.ru/Merchant/Index.aspx?` +
                       `MerchantLogin=${this.login}&` +
                       `OutSum=${amount}&` +
                       `InvId=${paymentId}&` +
                       `Description=${encodeURIComponent(description)}&` +
                       `SignatureValue=${crc}&` +
                       `shp_userId=${userId}`;
            }
            
            md5(input) {
                // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è MD5 –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                let hash = 0;
                for (let i = 0; i < input.length; i++) {
                    const char = input.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(16);
            }
            
            verifyWebhookSignature(outSum, invId, signature, userId) {
                const checkString = `${this.login}:${outSum}:${invId}:${this.password2}:shp_userId=${userId}`;
                const checkSignature = this.md5(checkString).toUpperCase();
                return signature.toUpperCase() === checkSignature;
            }
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        class SkanerXEApp {
            constructor() {
                this.db = new Database();
                this.robokassa = new RobokassaPayment();
                this.currentUser = null;
                this.currentAnalysisId = null;
                this.selectedPaymentAmount = 50;
                
                this.init();
            }
            
            init() {
                this.checkAuth();
                this.setupEventListeners();
                this.startPaymentChecker();
            }
            
            checkAuth() {
                const savedUser = localStorage.getItem('current_user');
                if (savedUser) {
                    this.currentUser = JSON.parse(savedUser);
                    this.showApp();
                } else {
                    this.showAuth();
                }
            }
            
            showAuth() {
                document.getElementById('auth-section').style.display = 'block';
                document.getElementById('app-section').style.display = 'none';
                document.getElementById('user-info').style.display = 'none';
            }
            
            showApp() {
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('app-section').style.display = 'block';
                document.getElementById('user-info').style.display = 'flex';
                
                document.getElementById('user-email').textContent = this.currentUser.email;
                if (this.currentUser.is_admin) {
                    document.getElementById('admin-badge').style.display = 'inline-block';
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'block';
                    });
                }
                
                this.updateUI();
                this.loadUserAnalyses();
                if (this.currentUser.is_admin) {
                    this.loadAdminData();
                }
            }
            
            setupEventListeners() {
                // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
                document.getElementById('login-btn').addEventListener('click', () => this.login());
                document.getElementById('register-btn').addEventListener('click', () => this.register());
                document.getElementById('logout-btn').addEventListener('click', () => this.logout());
                
                // –§–æ—Ä–º—ã
                document.getElementById('login-password').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.login();
                });
                document.getElementById('register-confirm').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.register();
                });
                
                // –í–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        tab.classList.add('active');
                        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
                    });
                });
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
                const uploadArea = document.getElementById('upload-area');
                const fileInput = document.getElementById('file-input');
                
                uploadArea.addEventListener('click', () => fileInput.click());
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = 'var(--primary)';
                    uploadArea.style.background = '#f0f4ff';
                });
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.style.borderColor = '#cbd5e0';
                    uploadArea.style.background = '';
                });
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#cbd5e0';
                    uploadArea.style.background = '';
                    
                    if (e.dataTransfer.files.length) {
                        this.handleImageFile(e.dataTransfer.files[0]);
                    }
                });
                
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files && e.target.files[0]) {
                        this.handleImageFile(e.target.files[0]);
                    }
                });
                
                // –ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ
                document.getElementById('analyze-btn').addEventListener('click', () => this.analyzePhoto());
                
                // –ü–ª–∞—Ç–µ–∂–∏
                document.querySelectorAll('.payment-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                        option.classList.add('selected');
                        this.selectedPaymentAmount = parseInt(option.dataset.amount);
                        document.getElementById('custom-amount').value = '';
                    });
                });
                
                document.getElementById('custom-amount').addEventListener('input', (e) => {
                    if (e.target.value) {
                        document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                        this.selectedPaymentAmount = parseInt(e.target.value) || 0;
                    }
                });
                
                document.getElementById('payment-btn').addEventListener('click', () => this.processPayment());
                document.getElementById('topup-btn').addEventListener('click', () => {
                    document.querySelector('.tab[data-tab="payments"]').click();
                });
                document.getElementById('check-payments-btn').addEventListener('click', () => this.checkPendingPayments());
                
                // –ü–µ—Ä–µ—Å—á–µ—Ç
                document.getElementById('recalculate-btn').addEventListener('click', () => this.recalculateWithNewWeight());
                
                // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
                document.getElementById('save-settings-btn').addEventListener('click', () => this.saveSettings());
            }
            
            // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
            login() {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                if (!email || !password) {
                    this.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                    return;
                }
                
                const result = this.db.loginUser(email, password);
                if (result.success) {
                    this.currentUser = result.user;
                    localStorage.setItem('current_user', JSON.stringify(this.currentUser));
                    this.showApp();
                    this.showAlert('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', 'success');
                } else {
                    this.showAlert(result.error, 'error');
                }
            }
            
            register() {
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirm = document.getElementById('register-confirm').value;
                
                if (!email || !password || !confirm) {
                    this.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                    return;
                }
                
                if (password !== confirm) {
                    this.showAlert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    this.showAlert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return;
                }
                
                const result = this.db.registerUser(email, password);
                if (result.success) {
                    this.showAlert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–µ–ø–µ—Ä—å –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É', 'success');
                    document.getElementById('register-email').value = '';
                    document.getElementById('register-password').value = '';
                    document.getElementById('register-confirm').value = '';
                } else {
                    this.showAlert(result.error, 'error');
                }
            }
            
            logout() {
                this.currentUser = null;
                localStorage.removeItem('current_user');
                this.showAuth();
            }
            
            // –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ç–æ
            handleImageFile(file) {
                if (!file.type.match('image.*')) {
                    this.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const preview = document.getElementById('image-preview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    document.getElementById('analyze-btn').style.display = 'block';
                    this.currentImageData = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            async analyzePhoto() {
                if (!this.currentImageData) {
                    this.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ', 'error');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
                if (this.currentUser.free_requests <= 0 && this.currentUser.balance < 1) {
                    this.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.', 'error');
                    document.querySelector('.tab[data-tab="payments"]').click();
                    return;
                }
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('analyze-loader').style.display = 'block';
                document.getElementById('analyze-btn').disabled = true;
                
                try {
                    // –≠–º—É–ª—è—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ AI
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    const analysisResult = this.generateAnalysisResult();
                    const analysisId = this.db.addAnalysis(this.currentUser.email, analysisResult);
                    this.currentAnalysisId = analysisId;
                    
                    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
                    if (this.currentUser.free_requests > 0) {
                        this.db.useFreeRequest(this.currentUser.email);
                    } else {
                        this.db.updateUserBalance(this.currentUser.email, -1);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    this.currentUser = {
                        ...this.currentUser,
                        balance: this.db.users[this.currentUser.email].balance,
                        free_requests: this.db.users[this.currentUser.email].free_requests
                    };
                    localStorage.setItem('current_user', JSON.stringify(this.currentUser));
                    
                    this.displayAnalysisResult(analysisResult);
                    this.showAlert('–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞:', error);
                    this.showAlert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ñ–æ—Ç–æ', 'error');
                } finally {
                    document.getElementById('analyze-loader').style.display = 'none';
                    document.getElementById('analyze-btn').disabled = false;
                }
            }
            
            generateAnalysisResult() {
                const dishes = [
                    { name: '–°–∞–ª–∞—Ç –æ–≤–æ—â–Ω–æ–π', type: 'vegetarian', health: 'healthy' },
                    { name: '–ö—É—Ä–∏–Ω—ã–π —Å—É–ø —Å –ª–∞–ø—à–æ–π', type: 'meat', health: 'balanced' },
                    { name: '–ü–∞—Å—Ç–∞ –∫–∞—Ä–±–æ–Ω–∞—Ä–∞', type: 'meat', health: 'high_calorie' },
                    { name: '–ì—Ä–µ—á–Ω–µ–≤–∞—è –∫–∞—à–∞ —Å –º—è—Å–æ–º', type: 'meat', health: 'balanced' },
                    { name: '–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏', type: 'vegetarian', health: 'healthy' },
                    { name: '–ü–ª–æ–≤', type: 'meat', health: 'high_calorie' },
                    { name: '–ë–æ—Ä—â', type: 'meat', health: 'balanced' },
                    { name: '–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞', type: 'vegetarian', health: 'high_calorie' },
                    { name: '–°—Ç–µ–π–∫ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã', type: 'meat', health: 'protein_rich' }
                ];
                
                const dish = dishes[Math.floor(Math.random() * dishes.length)];
                const weight = 200 + Math.floor(Math.random() * 400);
                const calories = 150 + Math.floor(Math.random() * 500);
                const protein = 5 + Math.floor(Math.random() * 30);
                const fat = 3 + Math.floor(Math.random() * 20);
                const carbs = 10 + Math.floor(Math.random() * 60);
                const breadUnits = Math.round((carbs / 12) * 10) / 10;
                
                return {
                    dish_name: dish.name,
                    dish_type: dish.type,
                    health_level: dish.health,
                    weight: weight,
                    calories: calories,
                    protein: protein,
                    fat: fat,
                    carbs: carbs,
                    bread_units: breadUnits,
                    ingredients: this.generateIngredients(dish.name)
                };
            }
            
            generateIngredients(dish) {
                const ingredientsMap = {
                    '–°–∞–ª–∞—Ç –æ–≤–æ—â–Ω–æ–π': ['–ø–æ–º–∏–¥–æ—Ä—ã: 150–≥', '–æ–≥—É—Ä—Ü—ã: 100–≥', '–ª—É–∫: 30–≥', '–º–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ: 15–≥'],
                    '–ö—É—Ä–∏–Ω—ã–π —Å—É–ø —Å –ª–∞–ø—à–æ–π': ['–∫—É—Ä–∏–Ω—ã–π –±—É–ª—å–æ–Ω: 300–≥', '–∫—É—Ä–∏—Ü–∞: 100–≥', '–ª–∞–ø—à–∞: 50–≥', '–º–æ—Ä–∫–æ–≤—å: 30–≥', '–ª—É–∫: 20–≥'],
                    '–ü–∞—Å—Ç–∞ –∫–∞—Ä–±–æ–Ω–∞—Ä–∞': ['–ø–∞—Å—Ç–∞: 200–≥', '–±–µ–∫–æ–Ω: 80–≥', '—Å–ª–∏–≤–∫–∏: 50–≥', '—Å—ã—Ä –ø–∞—Ä–º–µ–∑–∞–Ω: 30–≥', '—è–π—Ü–æ: 50–≥'],
                    '–ì—Ä–µ—á–Ω–µ–≤–∞—è –∫–∞—à–∞ —Å –º—è—Å–æ–º': ['–≥—Ä–µ—á–∫–∞: 150–≥', '–≥–æ–≤—è–¥–∏–Ω–∞: 100–≥', '–ª—É–∫: 50–≥', '–º–æ—Ä–∫–æ–≤—å: 50–≥', '–º–∞—Å–ª–æ: 20–≥'],
                    '–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏': ['—è–π—Ü–∞: 120–≥', '–ø–æ–º–∏–¥–æ—Ä—ã: 80–≥', '–ø–µ—Ä–µ—Ü: 60–≥', '–ª—É–∫: 30–≥', '–º–∞—Å–ª–æ: 15–≥'],
                    '–ü–ª–æ–≤': ['—Ä–∏—Å: 150–≥', '–±–∞—Ä–∞–Ω–∏–Ω–∞: 120–≥', '–º–æ—Ä–∫–æ–≤—å: 80–≥', '–ª—É–∫: 50–≥', '–º–∞—Å–ª–æ: 25–≥'],
                    '–ë–æ—Ä—â': ['–±—É–ª—å–æ–Ω: 300–≥', '—Å–≤–µ–∫–ª–∞: 100–≥', '–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å: 80–≥', '–∫–∞–ø—É—Å—Ç–∞: 70–≥', '–º—è—Å–æ: 60–≥', '—Å–º–µ—Ç–∞–Ω–∞: 30–≥'],
                    '–ü–∏—Ü—Ü–∞ –ú–∞—Ä–≥–∞—Ä–∏—Ç–∞': ['—Ç–µ—Å—Ç–æ: 200–≥', '—Å—ã—Ä –º–æ—Ü–∞—Ä–µ–ª–ª–∞: 120–≥', '—Ç–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å: 80–≥', '–ø–æ–º–∏–¥–æ—Ä—ã: 60–≥', '–±–∞–∑–∏–ª–∏–∫: 10–≥'],
                    '–°—Ç–µ–π–∫ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã': ['–≥–æ–≤—è–¥–∏–Ω–∞: 250–≥', '—Å–ø–µ—Ü–∏–∏: 5–≥', '–º–∞—Å–ª–æ: 15–≥']
                };
                
                return ingredientsMap[dish] || ['–æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: 200–≥'];
            }
            
            generateRecommendations(analysis) {
                const recommendations = {
                    healthy: [
                        "–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –≠—Ç–æ –±–ª—é–¥–æ —Ö–æ—Ä–æ—à–æ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–æ.",
                        "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ—á–µ—Ç–∞—Ç—å —Å –ª–µ–≥–∫–∏–º –≥–∞—Ä–Ω–∏—Ä–æ–º.",
                        "–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è."
                    ],
                    balanced: [
                        "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –±–ª—é–¥–æ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞.",
                        "–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ –¥–ª—è –±–æ–ª—å—à–µ–π –ø–æ–ª—å–∑—ã.",
                        "–•–æ—Ä–æ—à–µ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤ –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤."
                    ],
                    high_calorie: [
                        "–í—ã—Å–æ–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ –±–ª—é–¥–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–º–µ—Ä–µ–Ω–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ.",
                        "–°–æ—á–µ—Ç–∞–π—Ç–µ —Å –ª–µ–≥–∫–∏–º–∏ —Å–∞–ª–∞—Ç–∞–º–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞.",
                        "–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–Ω—è –∏–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫."
                    ],
                    protein_rich: [
                        "–ë–æ–≥–∞—Ç–æ –±–µ–ª–∫–æ–º, –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –º—ã—à—Ü.",
                        "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫.",
                        "–°–æ—á–µ—Ç–∞–π—Ç–µ —Å —É–≥–ª–µ–≤–æ–¥–∞–º–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ —É—Å–≤–æ–µ–Ω–∏—è."
                    ]
                };
                
                const healthTips = {
                    vegetarian: "–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–æ–µ –±–ª—é–¥–æ –±–æ–≥–∞—Ç–æ –∫–ª–µ—Ç—á–∞—Ç–∫–æ–π –∏ –≤–∏—Ç–∞–º–∏–Ω–∞–º–∏.",
                    meat: "–ú—è—Å–Ω–æ–µ –±–ª—é–¥–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –±–µ–ª–∫–æ–º.",
                    balanced: "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–æ—Å—Ç–∞–≤ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤."
                };
                
                const dishRecs = recommendations[analysis.health_level] || recommendations.balanced;
                const randomRec = dishRecs[Math.floor(Math.random() * dishRecs.length)];
                const healthTip = healthTips[analysis.dish_type] || "";
                
                return `
                    <h4>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø–∏—Ç–∞–Ω–∏—é</h4>
                    <p><strong>${randomRec}</strong></p>
                    <p>${healthTip}</p>
                    <p><strong>–°–æ–≤–µ—Ç:</strong> ${this.getNutritionTip(analysis)}</p>
                `;
            }
            
            getNutritionTip(analysis) {
                if (analysis.calories > 400) {
                    return "–≠—Ç–æ –±–ª—é–¥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–∞–ª–æ—Ä–∏–π–Ω–æ–µ, —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –µ–≥–æ –≤ —Å–≤–æ–µ–º –¥–Ω–µ–≤–Ω–æ–º —Ä–∞—Ü–∏–æ–Ω–µ.";
                } else if (analysis.protein > 20) {
                    return "–ë–æ–≥–∞—Ç—ã–π –±–µ–ª–∫–æ–º –ø—Ä–∏–µ–º –ø–∏—â–∏, –æ—Ç–ª–∏—á–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –º—ã—à–µ—á–Ω–æ–π –º–∞—Å—Å—ã.";
                } else if (analysis.carbs > 40) {
                    return "–í—ã—Å–æ–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É–≥–ª–µ–≤–æ–¥–æ–≤ –æ–±–µ—Å–ø–µ—á–∏—Ç —ç–Ω–µ—Ä–≥–∏–µ–π –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤.";
                } else {
                    return "–õ–µ–≥–∫–æ–µ –∏ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –±–ª—é–¥–æ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ª—é–±–æ–≥–æ –ø—Ä–∏–µ–º–∞ –ø–∏—â–∏.";
                }
            }
            
            displayAnalysisResult(data) {
                const resultArea = document.getElementById('result-area');
                const nutritionGrid = document.getElementById('nutrition-grid');
                
                nutritionGrid.innerHTML = `
                    <div class="nutrition-item">
                        <div class="nutrition-value">${data.calories}</div>
                        <div class="nutrition-label">–∫–∫–∞–ª</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">${data.protein}</div>
                        <div class="nutrition-label">–±–µ–ª–∫–∏ (–≥)</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">${data.fat}</div>
                        <div class="nutrition-label">–∂–∏—Ä—ã (–≥)</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">${data.carbs}</div>
                        <div class="nutrition-label">—É–≥–ª–µ–≤–æ–¥—ã (–≥)</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">${data.bread_units}</div>
                        <div class="nutrition-label">—Ö–ª–µ–±–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã</div>
                    </div>
                    <div class="nutrition-item">
                        <div class="nutrition-value">${data.weight}</div>
                        <div class="nutrition-label">–≤–µ—Å (–≥)</div>
                    </div>
                `;
                
                document.getElementById('result-title').textContent = `–ë–ª—é–¥–æ: ${data.dish_name}`;
                document.getElementById('weight-input').value = data.weight;
                document.getElementById('recommendations').innerHTML = this.generateRecommendations(data);
                
                resultArea.style.display = 'block';
                resultArea.scrollIntoView({ behavior: 'smooth' });
                
                this.loadUserAnalyses();
            }
            
            recalculateWithNewWeight() {
                const weightInput = document.getElementById('weight-input');
                const weight = parseInt(weightInput.value);
                
                if (!weight || weight <= 0) {
                    this.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–µ—Å', 'error');
                    return;
                }
                
                if (!this.currentAnalysisId) {
                    this.showAlert('–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ñ–æ—Ç–æ', 'error');
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
                if (this.currentUser.balance < 1) {
                    this.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.', 'error');
                    document.querySelector('.tab[data-tab="payments"]').click();
                    return;
                }
                
                const originalAnalysis = this.db.analyses[this.currentAnalysisId];
                if (!originalAnalysis) {
                    this.showAlert('–î–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
                    return;
                }
                
                // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                const ratio = weight / originalAnalysis.weight;
                const recalculatedData = {
                    ...originalAnalysis,
                    weight: weight,
                    calories: Math.round(originalAnalysis.calories * ratio),
                    protein: Math.round(originalAnalysis.protein * ratio * 10) / 10,
                    fat: Math.round(originalAnalysis.fat * ratio * 10) / 10,
                    carbs: Math.round(originalAnalysis.carbs * ratio * 10) / 10,
                    bread_units: Math.round(originalAnalysis.bread_units * ratio * 10) / 10
                };
                
                // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
                this.db.updateUserBalance(this.currentUser.email, -1);
                this.currentUser.balance = this.db.users[this.currentUser.email].balance;
                localStorage.setItem('current_user', JSON.stringify(this.currentUser));
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
                const newAnalysisId = this.db.addAnalysis(this.currentUser.email, recalculatedData);
                this.currentAnalysisId = newAnalysisId;
                
                this.displayAnalysisResult(recalculatedData);
                this.showAlert('–ü–µ—Ä–µ—Å—á–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!', 'success');
                this.updateUI();
            }
            
            // –ü–ª–∞—Ç–µ–∂–∏
            processPayment() {
                if (this.selectedPaymentAmount < this.db.settings.min_payment) {
                    this.showAlert(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è: ${this.db.settings.min_payment} —Ä—É–±`, 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º –ø–ª–∞—Ç–µ–∂ –≤ –±–∞–∑–µ
                const paymentId = this.db.createPayment(this.currentUser.email, this.selectedPaymentAmount);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è Robokassa
                const userId = this.currentUser.email.replace(/[^a-zA-Z0-9]/g, '_');
                const paymentUrl = this.robokassa.generatePaymentLink(
                    this.selectedPaymentAmount, 
                    paymentId, 
                    userId
                );
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã
                window.open(paymentUrl, '_blank');
                this.showAlert(`–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã ${this.selectedPaymentAmount} —Ä—É–±...`, 'info');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ –¥–ª—è –≤–µ–±—Ö—É–∫–∞
                this.savePaymentForWebhook(paymentId, this.selectedPaymentAmount, userId);
            }
            
            savePaymentForWebhook(paymentId, amount, userId) {
                const paymentData = {
                    payment_id: paymentId,
                    amount: amount,
                    user_id: userId,
                    timestamp: new Date().toISOString(),
                    status: 'pending'
                };
                
                let webhookPayments = JSON.parse(localStorage.getItem('skanerxe_webhook_payments') || '[]');
                webhookPayments.push(paymentData);
                localStorage.setItem('skanerxe_webhook_payments', JSON.stringify(webhookPayments));
            }
            
            checkPendingPayments() {
                const pendingPayments = this.db.getPendingPayments(this.currentUser.email);
                const container = document.getElementById('pending-payments');
                
                if (pendingPayments.length === 0) {
                    container.innerHTML = '<p>–ù–µ—Ç –æ–∂–∏–¥–∞—é—â–∏—Ö –ø–ª–∞—Ç–µ–∂–µ–π</p>';
                } else {
                    let html = '';
                    pendingPayments.forEach(payment => {
                        html += `
                            <div style="padding: 10px; border-bottom: 1px solid #e2e8f0;">
                                <strong>${payment.amount} —Ä—É–±</strong> - ${payment.status}
                                <br><small>${new Date(payment.created_at).toLocaleString()}</small>
                            </div>
                        `;
                    });
                    container.innerHTML = html;
                }
                
                this.showAlert('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
            }
            
            startPaymentChecker() {
                // –≠–º—É–ª—è—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                setInterval(() => {
                    this.checkWebhookPayments();
                }, 30000);
            }
            
            checkWebhookPayments() {
                const webhookPayments = JSON.parse(localStorage.getItem('skanerxe_webhook_payments') || '[]');
                const now = new Date();
                
                webhookPayments.forEach((payment, index) => {
                    const paymentTime = new Date(payment.timestamp);
                    const diffMinutes = (now - paymentTime) / (1000 * 60);
                    
                    // –≠–º—É–ª–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã
                    if (diffMinutes >= 2 && payment.status === 'pending') {
                        payment.status = 'completed';
                        
                        // –ù–∞—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥—Å—Ç–≤–∞
                        const userEmail = this.currentUser ? this.currentUser.email : Object.keys(this.db.users)[0];
                        this.db.updateUserBalance(userEmail, payment.amount);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑–µ
                        if (this.db.payments[payment.payment_id]) {
                            this.db.completePayment(payment.payment_id);
                        }
                        
                        this.showAlert(`–ü–ª–∞—Ç–µ–∂ –Ω–∞ ${payment.amount} —Ä—É–± –∑–∞–≤–µ—Ä—à–µ–Ω!`, 'success');
                        
                        if (this.currentUser) {
                            this.currentUser.balance = this.db.users[this.currentUser.email].balance;
                            localStorage.setItem('current_user', JSON.stringify(this.currentUser));
                            this.updateUI();
                        }
                    }
                });
                
                localStorage.setItem('skanerxe_webhook_payments', JSON.stringify(webhookPayments));
            }
            
            // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            loadAdminData() {
                const stats = this.db.getStats();
                document.getElementById('stat-users').textContent = stats.total_users;
                document.getElementById('stat-balance').textContent = stats.total_balance + ' —Ä—É–±';
                document.getElementById('stat-analyses').textContent = stats.total_analyses;
                document.getElementById('stat-payments').textContent = stats.pending_payments;
                
                document.getElementById('min-payment').value = this.db.settings.min_payment;
                
                this.loadUsersList();
            }
            
            loadUsersList() {
                const users = this.db.getAllUsers();
                const container = document.getElementById('users-list');
                
                if (users.length === 0) {
                    container.innerHTML = '<p>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                    return;
                }
                
                let html = '';
                users.forEach(user => {
                    html += `
                        <div class="user-item">
                            <div>
                                <div class="user-email">${user.email} ${user.is_admin ? '<span class="admin-badge">ADMIN</span>' : ''}</div>
                                <div>–ë–∞–ª–∞–Ω—Å: <span class="user-balance">${user.balance} —Ä—É–±</span> | –ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤: ${user.free_requests}</div>
                                <small>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(user.created_at).toLocaleDateString()}</small>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
            
            saveSettings() {
                const minPayment = parseInt(document.getElementById('min-payment').value);
                
                if (minPayment < 10) {
                    this.showAlert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ 10 —Ä—É–±–ª–µ–π', 'error');
                    return;
                }
                
                this.db.settings.min_payment = minPayment;
                this.db.saveSettings();
                this.showAlert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
            updateUI() {
                document.getElementById('balance-amount').textContent = this.currentUser.balance + ' —Ä—É–±';
                document.getElementById('free-requests').textContent = `–ë–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤: ${this.currentUser.free_requests}/10`;
                
                const analyzeBtn = document.getElementById('analyze-btn');
                if (this.currentUser.free_requests > 0) {
                    analyzeBtn.textContent = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, –æ—Å—Ç–∞–ª–æ—Å—å: ${this.currentUser.free_requests})`;
                } else {
                    analyzeBtn.textContent = '–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å (1 —Ä—É–±–ª—å)';
                }
            }
            
            loadUserAnalyses() {
                const analyses = this.db.getUserAnalyses(this.currentUser.email);
                const container = document.getElementById('history-list');
                
                if (analyses.length === 0) {
                    container.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–Ω–∞–ª–∏–∑–æ–≤</p>';
                    return;
                }
                
                let html = '';
                analyses.slice(0, 10).forEach(analysis => {
                    html += `
                        <div class="history-item">
                            <div class="history-date">${new Date(analysis.created_at).toLocaleString()}</div>
                            <div class="history-dish">${analysis.dish_name}</div>
                            <div class="history-calories">${analysis.calories} –∫–∫–∞–ª | ${analysis.weight} –≥</div>
                        </div>
                    `;
                });
                container.innerHTML = html;
            }
            
            showAlert(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.textContent = message;
                
                const mainContent = document.querySelector('.main-content');
                mainContent.insertBefore(alertDiv, mainContent.firstChild);
                
                setTimeout(() => {
                    alertDiv.remove();
                }, 5000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            window.skanerXEApp = new SkanerXEApp();
        });
    </script>
</body>
</html>
